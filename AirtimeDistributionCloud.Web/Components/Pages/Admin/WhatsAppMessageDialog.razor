@rendermode InteractiveServer
@inject IJSRuntime JS
@inject ISnackbar Snackbar

<MudDialog>
    <DialogContent>
        <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-3">
            Copy the message below and paste it in the WhatsApp group.
        </MudText>
        <MudPaper Elevation="0" Class="pa-4" Style="background:#f5f5f5; border-radius:8px; white-space:pre-wrap; font-family:monospace; font-size:0.85rem; line-height:1.6; max-height:400px; overflow-y:auto;">
            @Message
        </MudPaper>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Close" Variant="Variant.Text">Close</MudButton>
        @if (!string.IsNullOrWhiteSpace(GroupUrl))
        {
            <MudButton Color="Color.Success" Variant="Variant.Outlined"
                       StartIcon="@Icons.Material.Filled.OpenInNew"
                       OnClick="OpenGroup">Open Group</MudButton>
        }
        <MudButton Color="Color.Primary" Variant="Variant.Filled"
                   StartIcon="@Icons.Material.Filled.ContentCopy"
                   OnClick="CopyToClipboard">Copy Message</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] private IMudDialogInstance MudDialog { get; set; } = null!;
    [Parameter] public string Message { get; set; } = "";
    [Parameter] public string GroupUrl { get; set; } = "";

    private async Task CopyToClipboard()
    {
        try
        {
            await JS.InvokeVoidAsync("navigator.clipboard.writeText", Message);
            Snackbar.Add("Message copied to clipboard!", Severity.Success);
        }
        catch
        {
            Snackbar.Add("Could not copy â€” please select and copy manually", Severity.Warning);
        }
    }

    private async Task OpenGroup()
    {
        try
        {
            await JS.InvokeVoidAsync("open", GroupUrl, "_blank");
        }
        catch
        {
            // Best-effort
        }
    }

    private void Close() => MudDialog.Close();
}
